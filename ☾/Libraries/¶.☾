â®Œ functools â¨¡ cache

î¬¦ ó°¤±negative k and speedup with â¹ and % magic
âŠ¢smolfactor(n,k=1):
    Â¿k>n: â†ª0
    Â¿k<1: â†ª1
    Â¿kâ‰¡1âˆ§2âˆ£n: â†ª2
    âˆ€pâˆˆkó·¸ºn:
        Â¿pâˆ£n: â†ªp
    â†ªn

âŠ¢firstâ„•bool(c,r=2):
    Â¿c(1): â†ª1
    ub=1
    â°Â¬c(ub):
        ubó·¸Šâ‹…r
    lb=ubâ¹r
    â°ub-lb>1:
        m=(ub+lb)â¹2
        Â¿c(m): ub=m
        Â¡: lb=m
    â†ªub

ó±€˜ Â¶Â´:
    @cache
    âŠ¢__contains__(ğ•Š,n):
        Â¿nâ‰¤1: â†ªâœ—
        Â¿2âˆ£n: â†ªnâ‰¡2
        Â¿n<10000: î¬¦ normal test
            âˆ€kâˆˆ3ó·¸»Â²â¬’(âˆšn):
                Â¿kâˆ£n: â†ªâœ—
            â†ªâœ“
        âˆ€kâˆˆ3ó·¸»Â²100:
            Â¿kâˆ£n: â†ªâœ—
        î¬¦ strong pseudoprime check
        Â¿pow(2,(n-1)â¹2âŒƒ(sâ‰”(n-1)Â¶Â²),n)â‰•aâ‰ 1:
            âˆ€râˆˆsâ­¥:
                Â¿aâ‰¡n-1: â‡¥
                aó·¸Š Â²%n
            Â¡:
                â†ªâœ—
        î¬¦ check for square number ó°¤± make faster by using binary to get good first approx
        Â¿firstâ„•bool(ó·º¹Â²â‰¥n)Â²â‰¡n: â†ªâœ—
        î¬¦ strong lucas pseudoprime check
        D=5
        â°(âœ¿)(D,n)â‰ ó·°¾: Dó·¸Šâ´µâ‹…ó·°¿-D
        s=(n+1)Â¶Â²
        d=n+1â†’â¹2âŒƒs
        B=bin(d)â‚ƒï¹•
        P,Q=1,(1-D)â¹4
        U,V,Qk=1,P,Q
        âˆ€bâˆˆB:
            U, V, Qk = Uâ‹…V%n, (VÂ²-2Qk)%n, pow(Qk,2,n)
            Â¿bâ‰¡â›1:
                U, V, Qk = ((2âˆ£ğ“½â‰”Pâ‹…U+V)â­œğ“½â­ğ“½+n)â¹2%n, ((2âˆ£ğ“½â‰”Dâ‹…U+Pâ‹…V)â­œğ“½â­ğ“½+n)â¹2%n, Qkâ‹…Q%n
        Â¿U:
            âˆ€râˆˆsâ­¥:
                Â¿Â¬V: â‡¥
                U,V,Qk=Uâ‹…V%n,(VÂ²-2Qk)%n,pow(Qk,2,n)
            Â¡:
                â†ªâœ—
        Â¿n<2â¶â´: â†ªâœ“ î¬¦ Baillie PSW test stops being known here
        î¬¦ ó°¤± pocklington test
        î¬¦ ó°¤± tell if n-1 is easily factored?
        Â¿n<2Â¹âµâ°â°:
            âœ—â¨³â€¹ó°¤± implement APRCL for n<2Â¹âµâ°â°â€º
        î¬¦ ó°¤± APRCL
        âœ—â¨³â€¹ó°¤± implement ECPP for n>2Â¹âµâ°â°â€º
        î¬¦ ó°¤± ECPP
    __getitem__ = â¥Œğ•Š,tâ†¦ğš²ğ•Š.__call__(â ¤ğ”¸,s=t)
    âŠ¢ __call__(ğ•Š,x,s=â€):
        Â¿xâ‰…âˆ: â†ª â€¹ó°¤± âˆ primesâ€º
        Â¿sâ‰…â€: î¬¦ ó°¤± speedup
            Â¿xâ‰¤1: â†ª[2]â‹…x
            t,p=[2],3
            â°tğŸƒŒ<x:
                Â¿pâˆˆÂ¶: t.append(p)
                pó·¸Š+2
            â†ªt
        Â¿sá¹â„¤:
            t=0
            â°sâˆ£x:
                tó·¸Š+1
                xó·¸Šâ¹s
            â†ªt
        Â¿sâ‰…<Â´: â†ª2ó·¸¹xó°ˆ²ó·º¹âˆˆÂ¶ î¬¦ ó°¤± speedup
        Â¿sâ‰…+Â´: î¬¦ ó°¤± avoid floats and speedup with â¹ and % tricks and allow negatives
            Â¿(râ‰”â–¢(âˆšx))Â²â‰¡x: â†ª(1ó·¸¹ró°ˆ³á³x%ó·º½)â‰•fâ†’+[r]+â†fá´™áµâ¹áµœx
            â†ª(1ó·¸»ró°ˆ³á³x%ó·º½)â‰•fâ†’+â†fá´™áµâ¹áµœx
        Â¿sâ‰…âˆ£Â´: â†ªğ‘™(xÂ¶î î®†ó°»¾) î¬¦ ó°¤± speedup
        Â¿sâ‰…*Â´: î¬¦ ó°¤± speedup
            xó·¸Šâ«°
            Â¿xâ‰¡1: â†ªâ
            t=â
            â°x>1:
                t.append(sâ‰”smolfactor(x,tğŸƒŒâ­œtô¨„-1â­1))
                xó·¸Šâ¹s
            â†ªt
        Â¿sâ‰…âŠÂ´: â†ªâ„µâ°(xÂ¶î î®†ó°»¾êŸ¿âºó·º»ğŸƒŒó·º½) î¬¦ ó°¤± speedup
        Â¿sâ‰…â¨‰Â´: â†ªxÂ¶ô‹¼êŸ¿âºó·º¹â›¶ôª¹ó·º¿
        Â¿sâ‰…ô‹‘‚: xÂ¶ô‹’Ïœâ¿ó·º¹â‹…(âŸ-1)â¹ó·º½ î¬¦ ó°¤± speedup
        Â¿sâ‰…%Â´: î¬¦ ó°¤± speedup
            t=ó·°¾Â²ô‹’Ë£
            Â¿t>0: xó·¸Šâ¹2
            Â¿2âˆ£x: â†ª0
            p=3
            â°pâ‰¤x:
                Â¿pâˆ£x:
                    Â¿pÂ²âˆ£x: â†ª0
                xó·¸Šâ¹p
                pó·¸Š+2
                t=-t
            â†ªt
        Â¿sâ‰…ô‹‘¯: î¬¦ ó°¤± speedup
            Â¿2âˆ£x:
                â°2âˆ£x: xó·¸Šâ¹2
                â†ªxâ‰¡1âˆ§ô‹‘¯(2)
            p=3
            â°p<â¬’âˆšx:
                Â¿pâˆ£x:
                    â°pâˆ£x: xó·¸Šâ¹p
                    â†ªxâ‰¡1âˆ§ô‹‘¯(p)
                pó·¸Š+2
            â†ªô‹‘¯(x)
Â¶Â´ = Â¶Â´î®¦

âŠ¢âœ¿Â´(x,y,s=â€):
    Â¿yâ‰¡0: â†ªğ‘–(â«°xâ‰¡1)
    Â¿xâ‰¡0: â†ªğ‘–(yâˆˆÂ±1)
    Â¿ô‹‘‚(x,y)>1: â†ª0
    Â¿xâ‰¡1: â†ª1
    t=ó·°¾â°ó°‚Ë£ô‹”â°ó°‚Ê¸
    Â¿yÂ¶Â²â‰•r%2âˆ§x%8âˆˆ[3,5]: t=-t
    yó·¸Šâ«°â¹2âŒƒr
    Â¿yâ‰¡1: â†ªt
    xó·¸Š%y
    â†ªtâ‹…(âœ¿)(y,x)â‹…(ó·°¾âŒƒâ†(xâ¹2âŒƒ(xÂ¶Â²)-1)â‹…(y-1)â¹4)

__exports__ = â€¹Â¶â€‰âœ¿â€ºâ­